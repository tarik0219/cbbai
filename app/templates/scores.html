{% extends "base.html" %}
{% block title %}Scores{% endblock %}
{% block content %}
{% import "bootstrap/wtf.html" as wtf %}

<div class="page-header">
    <h1>üèÄ College Basketball Scores</h1>
    <p class="subtitle">{{search}} | {{date}}</p>
</div>

<div class="form-modern" style="max-width: 800px;">
    <form method="POST">
        {{ form.hidden_tag() }}
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="{{ form.entrydate.id }}">{{ form.entrydate.label }}</label>
                    {{ form.entrydate(class="form-control", id=form.entrydate.id) }}
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="{{ form.games.id }}">{{ form.games.label }}</label>
                    {{ form.games(class="form-control", id=form.games.id) }}
                </div>
            </div>
        </div>
        <div class="text-center">
            {{ form.submit(class="btn btn-primary btn-modern") }}
        </div>
    </form>
</div>

{% for game in data %}
<div class="game-card">
    <div class="game-header">
        <div class="game-time">
            {% if game.status == 'post' and game.period == 0 %}
                <span class="game-status" style="background-color: #dc2626;">POSTPONED</span>
            {% elif game.status == 'in' %}
                <span class="game-status live">üî¥ LIVE</span>
                <span>{{ game.half}} {{ game.clock}}</span>
            {% elif game.status == 'pre' %}
                <span>{{ game.time}} ET</span>
            {% elif game.status == 'post' and game.period > 2 %}
                <span class="game-status">FINAL {{game.half}}</span>
            {% else %}
                <span class="game-status">FINAL</span>
            {% endif %}
        </div>
        <div>
            {% if game.broadcast %}
                <span style="color: var(--text-secondary); font-size: 0.9rem;">üì∫ {{ game.broadcast}}</span>
            {% endif %}
        </div>
    </div>

    <!-- Away Team -->
    <div class="team-row {% if game.status == 'post' and game.awayScore > game.homeScore %}winner{% endif %}">
        <div class="team-info">
            <img src="{{ ''.join(['https://a.espncdn.com/i/teamlogos/ncaa/500/',game.awayTeamId,'.png']) }}"
                onerror="this.onerror=null; this.src='/static/pics/basketball.png'"
                alt="{{ ''.join([game.awayTeam]) }}" 
                class="team-logo"
                title="{{ ''.join([game.awayTeam]) }}">
            
            <div>
                {% if game.awayData |length != 0 %}
                    <a href="{{ ''.join(['/schedule/', game.awayTeamId ]) }}" class="team-name">
                        {{ game.awayTeam }}
                    </a>
                    <span class="stats-badge">#{{game.awayData.ranks.rank}}</span>
                {% else %}
                    <span class="team-name">{{ game.awayTeam }}</span>
                {% endif %}
            </div>
        </div>
        <div class="team-score">{{ game.awayScore if game.awayScore else '-' }}</div>
    </div>

    <!-- Home Team -->
    <div class="team-row {% if game.status == 'post' and game.homeScore > game.awayScore %}winner{% endif %}">
        <div class="team-info">
            <img src="{{ ''.join(['https://a.espncdn.com/i/teamlogos/ncaa/500/',game.homeTeamId,'.png']) }}"
                onerror="this.onerror=null; this.src='/static/pics/basketball.png'"
                alt="{{ ''.join([game.homeTeam]) }}" 
                class="team-logo"
                title="{{ ''.join([game.homeTeam]) }}">
            
            <div>
                {% if game.homeData |length != 0 %}
                    <a href="{{ ''.join(['/schedule/', game.homeTeamId ]) }}" class="team-name">
                        {{ game.homeTeam }}
                    </a>
                    <span class="stats-badge">#{{game.homeData.ranks.rank}}</span>
                {% else %}
                    <span class="team-name">{{ game.homeTeam }}</span>
                {% endif %}
            </div>
        </div>
        <div class="team-score">{{ game.homeScore if game.homeScore else '-' }}</div>
    </div>

    <!-- Prediction or Odds -->
    {% if game.status != 'post' and game.homeScorePredict != None %}
    <div style="text-align: center; padding-top: var(--spacing-md); border-top: 1px solid var(--border-color); margin-top: var(--spacing-md);">
        <span style="color: var(--text-secondary); font-size: 0.9rem;">
            <strong>AI Prediction:</strong> 
            {{ game.awayTeam }} {{game.awayScorePredict}} - {{game.homeScorePredict}} {{ game.homeTeam }}
        </span>
    </div>
    {% endif %}

    {% if game.spread != None and game.homeData |length != 0 %}
    <div style="text-align: center; padding-top: var(--spacing-md); border-top: 1px solid var(--border-color); margin-top: var(--spacing-md);">
        <span style="color: var(--text-secondary); font-size: 0.9rem;">
            <strong>Line:</strong> {{ game.homeTeam }} {% if game.spread > 0 %}+{{ game.spread}}{% else %}{{ game.spread}}{% endif %} | 
            <strong>O/U:</strong> {{game.overUnder}}
        </span>
    </div>
    {% endif %}

    <!-- Links -->
    <div style="text-align: center; padding-top: var(--spacing-sm); margin-top: var(--spacing-sm);">
        {% if game.status == 'post' or game.status == 'in' %}
            <a href="{{ ''.join(['/boxscore/', game.gameId, '/', datesearch]) }}" class="btn btn-primary btn-modern" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                üìä View Boxscore
            </a>
        {% elif game.status == 'pre' and game.homeData != None and game.awayData != None %}
            <a href="{{ ''.join(['/predict/', game.homeTeam, '/', game.awayTeam, '/', game.siteType ]) }}" class="btn btn-primary btn-modern" style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                üéØ Game Preview
            </a>
        {% endif %}
    </div>
</div>
{% endfor %}

{% endblock %}